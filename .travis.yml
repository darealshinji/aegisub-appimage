dist: xenial
language: cpp
compiler: gcc

git:
  depth: false

addons:
  apt:
    packages:
      - fuse
      - wget
      - adwaita-icon-theme
      - adwaita-icon-theme-full
      - build-essential
      - autoconf
      - automake
      - autotools-dev
      - autopoint
      - nasm
      - gettext
      - intltool
      - libtool
      - libgl1-mesa-dev
      - libx11-dev
      - libice-dev
      - libass-dev
      - libfreetype6-dev
      - libfontconfig1-dev
      - libicu-dev
      - libboost-chrono-dev
      - libboost-filesystem-dev
      - libboost-locale-dev
      - libboost-regex-dev
      - libboost-system-dev
      - libboost-thread-dev
      - libasound2-dev
      - libopenal-dev
      - libpulse-dev
      - libfftw3-dev
      - libhunspell-dev
      - libuchardet-dev
      - libwxbase3.0-dev
      - libwxgtk3.0-dev
      - wx3.0-headers

before_script:
  - d=aegisub-appimage; files="$(ls) .travis.yml"; mkdir $d; cp -r $files $d; tar cJf sources.tar.xz $d
  - wget https://github.com/linuxdeploy/linuxdeploy/releases/download/continuous/linuxdeploy-x86_64.AppImage
  - wget https://github.com/AppImage/AppImageKit/releases/download/continuous/appimagetool-x86_64.AppImage
  - wget https://github.com/linuxdeploy/linuxdeploy-plugin-gtk/raw/master/linuxdeploy-plugin-gtk.sh
  - wget https://github.com/probonopd/uploadtool/raw/master/upload.sh
  - chmod a+x *.AppImage *.sh

script:
  - ./build.sh

after_success:
  - test $TRAVIS_BRANCH != master || bash ./upload.sh aegisub-*.AppImage aegisub-*.tar.xz

branches:
  except:
    - # Do not build tags that we create when we upload to GitHub Releases
    - /^(?i:continuous)$/

